{
    "name": "Gramine Java Benchmark",
    "build": {
        "dockerfile": "Dockerfile",
        "context": ".."
    },
    "remoteUser": "dev",
    "runArgs": [
        "--name=gramine-java-sgx",
        "--device=/dev/sgx_enclave:/dev/sgx_enclave",
        "--device=/dev/sgx_provision:/dev/sgx_provision",
        "--device=/dev/sgx_vepc:/dev/sgx_vepc",
        "--publish",
        "127.0.0.1:2222:2222"
    ],
    "features": {
        "ghcr.io/devcontainers/features/sshd:1": {},
        "ghcr.io/devcontainers/features/common-utils:2": {
            "installZsh": "true",
            "configureZshAsDefaultShell": "true",
            "installOhMyZsh": "true",
            "upgradePackages": "true"
        },
        "ghcr.io/devcontainers/features/git:1": {
            "configureGitUser": true,
            "userName": "Luca Di Bello",
            "userEmail": "lucadibello@proton.me"
        },
        "ghcr.io/devcontainers-extra/features/tmux-apt-get:1": {},
        "ghcr.io/jungaretti/features/make:1": {},
        "ghcr.io/rocker-org/devcontainer-features/apt-packages:1": {
            "packages": "gcc, build-essential, zlib1g-dev, musl-tools, musl-dev"
        },
        "ghcr.io/audacioustux/devcontainers/graalvm:1": {
            "java": 21
        },
        "ghcr.io/devcontainers-extra/features/gradle-sdkman:2": {},
        "ghcr.io/devcontainers-extra/features/maven-sdkman:2": {}
    },
    "forwardPorts": [2222],
    "mounts": ["source=${localEnv:SSH_AUTH_SOCK},target=/ssh-agent,type=bind"],
    "hostRequirements": {
        "cpus": 2,
        "memory": "4gb"
    },
    "containerEnv": {
        "SSH_AUTH_SOCK": "/ssh-agent",
        "NVIM_LISTEN_ADDRESS": "127.0.0.1:6666"
    },
    "postCreateCommand": "echo '=== Verifying musl installation ===' && x86_64-linux-musl-gcc --version && echo '✓ musl-gcc is available' || echo '✗ musl-gcc not found'",
    "postStartCommand": "bash -lc \"if ! pgrep -u $(id -u) -f 'nvim --headless --listen' > /dev/null; then mkdir -p ~/.cache && nohup nvim --headless --listen ${NVIM_LISTEN_ADDRESS:-127.0.0.1:6666} > ~/.cache/nvim-server.log 2>&1 & fi\""
}
